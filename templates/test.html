<!DOCTYPE html>
<html>
  <head>
    <title>Test: 카메라 & 열화상</title>
    <style>
      .container { display: flex; }
      .panel { margin: 10px; }
    </style>
  </head>
  <body>
    <h1>Flame Boundary Tracking Module</h1>
    <div class="container">
      <div class="panel">
        <h3>카메라 영상</h3> 
        <img src="/camera/mjpeg_feed" width="320">
      </div>
      <div class="panel">
        <h3>MLX90640 열화상</h3>
        <canvas id="thermal-canvas" width="320" height="240"></canvas>
      </div>
    </div>
    <script>
      const width = 32, height = 24, scale = 10;
      const canvas = document.getElementById('thermal-canvas');
      const ctx = canvas.getContext('2d');
      async function fetchAndDraw() {
        try {
          const response = await fetch('/thermal/thermal-data');
          const json = await response.json();
          if (!json.data) return;
          let arr = json.data.flat();
          for(let y=0; y<height; y++){
            for(let x=0; x<width; x++){
              let v = arr[y*width + x];
              const norm = (v+20)/80;
              ctx.fillStyle = `hsl(${(1-norm)*240},100%,50%)`;
              ctx.fillRect(x*scale, y*scale, scale, scale);
            }
          }
        } catch(e) {}
      }
      setInterval(fetchAndDraw, 150);
    </script>
  </body>
</html>
